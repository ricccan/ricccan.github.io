<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>LLN Simulation (Compact)</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    font-family: system-ui, sans-serif;
    margin: 10px;
    background:#f4f6f9;
    color:#222;
  }
  h1 { text-align:center; font-size:1.4rem; margin-bottom:6px; color:#1f618d; }
  .controls {
    display:flex; flex-wrap:wrap; gap:6px; align-items:center;
    background:#fff; padding:8px; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08);
    margin-bottom:8px;
  }
  label { font-size:0.9rem; }
  input[type=number], input[type=range] {
    font-size:0.9rem; padding:3px 5px; border-radius:6px; border:1px solid #ccc;
  }
  button {
    background:#1f78b4; color:#fff; border:none; border-radius:6px;
    padding:6px 10px; cursor:pointer; font-size:0.9rem;
  }
  button.secondary { background:#27ae60; }
  .container { display:flex; gap:8px; flex-wrap:wrap; }
  .panel {
    background:#fff; border-radius:8px; box-shadow:0 2px 6px rgba(0,0,0,0.08);
    padding:8px; flex:1;
  }
  canvas { background:#fff; border-radius:6px; }
  .meta { font-size:0.8rem; text-align:center; color:#555; margin-top:4px; }
  #mainChart { height:220px; }
  #histChart { height:220px; }
</style>
</head>
<body>
  <h1>Law of Large Numbers — Compact Simulation</h1>

  <div class="controls">
    <label>p:<input id="pInput" type="number" value="0.3" min="0" max="1" step="0.01" /></label>
    <label>m:<input id="mInput" type="number" value="100" min="1" max="500" /></label>
    <label>N:<input id="nInput" type="number" value="500" min="10" max="5000" /></label>
    <button class="secondary" id="generateBtn">Generate</button>
    <label style="margin-left:auto;">n:<input type="range" id="nRange" min="1" max="500" value="1" style="width:140px;"></label>
    <span>n=<span id="nLabel">1</span></span>
    <button id="playBtn">▶</button>
    <button id="stopBtn">⏹</button>
  </div>

  <div class="container">
    <div class="panel" style="flex:1 1 60%;">
      <canvas id="mainChart"></canvas>
      <div class="meta">Trajectories of f(n) — dashed line = p</div>
    </div>
    <div class="panel" style="flex:1 1 35%;">
      <canvas id="histChart"></canvas>
      <div class="meta">Histogram of f(n) at selected n</div>
    </div>
  </div>

<script>
let mainChart=null, histChart=null;
let fValues=[], m=100, N=500, p=0.3, playing=false, timer=null;

const pInput=document.getElementById('pInput'),
      mInput=document.getElementById('mInput'),
      nInput=document.getElementById('nInput'),
      nRange=document.getElementById('nRange'),
      nLabel=document.getElementById('nLabel');

function bernoulli(p){return Math.random()<p?1:0;}

function buildSim(){
  p=parseFloat(pInput.value);
  m=parseInt(mInput.value);
  N=parseInt(nInput.value);
  fValues=new Array(m);
  for(let i=0;i<m;i++){
    let arr=new Float64Array(N+1), sum=0;
    for(let n=1;n<=N;n++){ sum+=bernoulli(p); arr[n]=sum/n; }
    fValues[i]=arr;
  }
  nRange.max=N; nRange.value=1; updateCharts(1);
}

function updateCharts(n){
  n=parseInt(n); nLabel.textContent=n;
  renderMain(n); renderHist(n);
}

function renderMain(n){
  const ctx=document.getElementById('mainChart').getContext('2d');
  if(mainChart) mainChart.destroy();
  const labels=Array.from({length:N},(_,i)=>i+1);
  const datasets=[];
  for(let i=0;i<Math.min(m,150);i++){
    datasets.push({data:Array.from({length:N},(_,k)=>fValues[i][k+1]),
      borderColor:'rgba(0,123,255,0.05)', borderWidth:1, pointRadius:0, fill:false});
  }
  const meanData=Array.from({length:N},(_,k)=>{
    let s=0;for(let i=0;i<m;i++) s+=fValues[i][k+1];return s/m;
  });
  datasets.push({data:meanData,borderColor:'#e74c3c',borderWidth:2,pointRadius:0});
  mainChart=new Chart(ctx,{type:'line',data:{labels,datasets},
    options:{
      animation:false,plugins:{legend:{display:false}},
      scales:{y:{min:0,max:1}},
      elements:{line:{tension:0.1}}
    }});
  // dashed p line
  const y=mainChart.scales.y.getPixelForValue(p);
  const {ctx:ctx2, chartArea:a}=mainChart;
  ctx2.save();ctx2.setLineDash([4,3]);ctx2.strokeStyle='#222';ctx2.beginPath();
  ctx2.moveTo(a.left,y);ctx2.lineTo(a.right,y);ctx2.stroke();ctx2.restore();
}

function renderHist(n){
  const ctx=document.getElementById('histChart').getContext('2d');
  if(histChart) histChart.destroy();
  const vals=fValues.map(v=>v[n]);
  const bins=20, counts=new Array(bins).fill(0);
  vals.forEach(v=>{
    let i=Math.min(bins-1,Math.floor(v*bins));counts[i]++;
  });
  const labels=Array.from({length:bins},(_,i)=>((i+0.5)/bins).toFixed(2));
  histChart=new Chart(ctx,{type:'bar',
    data:{labels,datasets:[{data:counts,backgroundColor:'rgba(46,134,193,0.8)'}]},
    options:{animation:false,indexAxis:'y',plugins:{legend:{display:false}},
      scales:{x:{display:false},y:{display:false}}}});
}

document.getElementById('generateBtn').onclick=buildSim;
nRange.oninput=e=>updateCharts(e.target.value);
document.getElementById('playBtn').onclick=()=>{
  if(playing) return; playing=true;
  let n=parseInt(nRange.value);
  timer=setInterval(()=>{
    n++; if(n>N){clearInterval(timer);playing=false;return;}
    nRange.value=n; updateCharts(n);
  },80);
};
document.getElementById('stopBtn').onclick=()=>{playing=false;clearInterval(timer);};

window.onload=buildSim;
</script>
</body>
</html>
